{"ast":null,"code":"import _classCallCheck from \"/home/dell/Dokumenty/sql-gen2/sql-gen2/sql-generator2/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/dell/Dokumenty/sql-gen2/sql-gen2/sql-generator2/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/dell/Dokumenty/sql-gen2/sql-gen2/sql-generator2/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/dell/Dokumenty/sql-gen2/sql-gen2/sql-generator2/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _get from \"/home/dell/Dokumenty/sql-gen2/sql-gen2/sql-generator2/node_modules/@babel/runtime/helpers/esm/get\";\nimport _inherits from \"/home/dell/Dokumenty/sql-gen2/sql-gen2/sql-generator2/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport * as _ from \"lodash\";\nimport { PortModel } from \"storm-react-diagrams\";\nimport { Link } from \"./Link\";\nimport { PropertyType } from \"./PropertyType\";\nimport { Node } from \"./Node\";\nimport { RelationType } from \"../../App2\";\nexport var Port =\n/*#__PURE__*/\nfunction (_PortModel) {\n  _inherits(Port, _PortModel);\n\n  function Port(isNotNull, isAutoIncremented, isUnique, isPrimaryKey, isForeignKey, isInput, name) {\n    var _this;\n\n    var label = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : null;\n    var selectedRelation = arguments.length > 8 ? arguments[8] : undefined;\n    var diagramEngine = arguments.length > 9 ? arguments[9] : undefined;\n    var propertyType = arguments.length > 10 ? arguments[10] : undefined;\n    var id = arguments.length > 11 ? arguments[11] : undefined;\n\n    _classCallCheck(this, Port);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Port).call(this, name, \"with_prop\", id));\n    _this.in = void 0;\n    _this.label = void 0;\n    _this.propertyType = void 0;\n    _this.isPrimaryKey = void 0;\n    _this.isForeignKey = void 0;\n    _this.isNotNull = void 0;\n    _this.isUnique = void 0;\n    _this.isAutoIncremented = void 0;\n    _this.links = void 0;\n    _this.iterator = 1;\n    _this.firstM2M = 1;\n    _this.selectedRelation = void 0;\n    _this.diagramEngine = void 0;\n    _this.in = isInput;\n    _this.label = label || name;\n    _this.links = {};\n    _this.propertyType = PropertyType[propertyType];\n    _this.isForeignKey = isForeignKey;\n    _this.isPrimaryKey = isPrimaryKey;\n    _this.selectedRelation = selectedRelation;\n    _this.diagramEngine = diagramEngine;\n    _this.isAutoIncremented = isAutoIncremented;\n    _this.isUnique = isUnique;\n    _this.isNotNull = isNotNull;\n    return _this;\n  }\n\n  _createClass(Port, [{\n    key: \"updatePortRelation\",\n    value: function updatePortRelation(selectedRelation) {\n      if (this.selectedRelation === RelationType.O2O || this.selectedRelation === RelationType.O2M && selectedRelation === RelationType.M2M) {\n        console.log('zmiana');\n        this.selectedRelation = selectedRelation;\n      }\n    }\n  }, {\n    key: \"deSerialize\",\n    value: function deSerialize(object, engine) {\n      _get(_getPrototypeOf(Port.prototype), \"deSerialize\", this).call(this, object, engine);\n\n      this.in = object.in;\n      this.label = object.label;\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize() {\n      return _.merge(_get(_getPrototypeOf(Port.prototype), \"serialize\", this).call(this), {\n        in: this.in,\n        label: this.label,\n        propertyType: this.propertyType,\n        isForeignKey: this.isForeignKey,\n        isPrimaryKey: this.isPrimaryKey,\n        isNotNull: this.isNotNull,\n        isAutoincremented: this.isAutoIncremented,\n        isUnique: this.isUnique\n      });\n    }\n  }, {\n    key: \"initialLink\",\n    value: function initialLink(nodeToLink) {\n      var thisPortNode = this.getNode();\n      var ports = nodeToLink.getInPorts();\n      var isThereAlreadyThatPort = ports.filter(function (p) {\n        return p.label === \"\".concat(thisPortNode.name, \"Id\");\n      }).length;\n\n      if (isThereAlreadyThatPort === 0) {\n        var link = this.createLinkModel();\n\n        if (link !== null) {\n          link.setSourcePort(this);\n          var newPort = nodeToLink.addInPort(true, false, false, false, true, \"\".concat(thisPortNode.name, \"Id\"), this.selectedRelation, this.diagramEngine, PropertyType.INT);\n          console.log('ports', this, newPort);\n          link.setTargetPort(newPort);\n          this.diagramEngine.getDiagramModel().addLink(link);\n          this.diagramEngine.recalculatePortsVisually();\n          console.log('link', link);\n          this.selectedRelation = RelationType.none;\n        }\n      }\n\n      this.selectedRelation = RelationType.none;\n      return null;\n    }\n  }, {\n    key: \"link\",\n    value: function link(nodeToLink) {\n      var thisPortNode = this.getNode();\n      var ports = nodeToLink.getInPorts();\n      var isThereAlreadyThatPort = ports.filter(function (p) {\n        return p.label === \"\".concat(thisPortNode.name, \"Id\");\n      }).length;\n\n      if (isThereAlreadyThatPort === 0) {\n        if (this.iterator === 1) {\n          var portLinks = this.getLinks();\n          {}\n          var linkToDelete = Object.keys(portLinks).filter(function (l) {\n            return portLinks[l].getTargetPort() === ports.filter(function (p) {\n              return p.label === 'Id';\n            })[0];\n          });\n          this.diagramEngine.getDiagramModel().removeLink(linkToDelete[0]);\n        }\n\n        var link = this.createLinkModel();\n\n        if (link !== null) {\n          link.setSourcePort(this);\n          var newPort = nodeToLink.addInPort(true, false, false, false, true, \"\".concat(thisPortNode.name, \"Id\"), this.selectedRelation, this.diagramEngine, PropertyType.INT);\n          console.log('ports', this, newPort);\n          link.setTargetPort(newPort);\n          this.diagramEngine.getDiagramModel().addLink(link);\n          this.diagramEngine.recalculatePortsVisually();\n          console.log('link', link);\n          this.selectedRelation = RelationType.none;\n        }\n      }\n\n      this.selectedRelation = RelationType.none;\n      return null;\n    }\n  }, {\n    key: \"createM2MNode\",\n    value: function createM2MNode(port1Name, port2Name) {\n      var nodes = this.diagramEngine.getDiagramModel().getNodes();\n      var isAlredy = Object.keys(nodes).filter(function (x) {\n        return nodes[x].name.slice(3) === \"\".concat(port1Name.slice(3, 8), \"Has\").concat(port2Name);\n      });\n\n      if (isAlredy.length === 0) {\n        var relationNode = new Node('table', \"rl_\".concat(port1Name, \"Has\").concat(port2Name));\n        relationNode.addInPort(true, true, true, true, false, \"Id\", this.selectedRelation, this.diagramEngine, PropertyType.INT);\n        relationNode.addInPort(true, true, false, false, true, \"\".concat(port1Name, \"Id\"), this.selectedRelation, this.diagramEngine, PropertyType.INT);\n        relationNode.addInPort(true, true, false, false, true, \"\".concat(port2Name, \"Id\"), this.selectedRelation, this.diagramEngine, PropertyType.INT);\n        this.diagramEngine.recalculatePortsVisually();\n        return relationNode;\n      }\n\n      return null;\n    }\n  }, {\n    key: \"addRelationLink\",\n    value: function addRelationLink(node1, relationtNode, node2, port, port1Name, port2Name) {\n      var portLinks = this.getLinks();\n      var link = Object.keys(portLinks).filter(function (l) {\n        return portLinks[l].getTargetPort() === port;\n      });\n      this.diagramEngine.getDiagramModel().removeLink(link[0]);\n      var link1 = this.createLinkModel();\n      var link2 = this.createLinkModel();\n\n      if (!link1 || !link2) {} else {\n        link1.setSourcePort(node1.getInPorts().filter(function (p) {\n          return p.label === 'Id';\n        })[0]);\n        link1.setTargetPort(relationtNode.getInPorts().filter(function (p) {\n          return p.label === \"\".concat(port1Name, \"Id\");\n        })[0]);\n        link2.setSourcePort(relationtNode.getInPorts().filter(function (p) {\n          return p.label === \"\".concat(port2Name, \"Id\");\n        })[0]);\n        link2.setTargetPort(node2.getInPorts().filter(function (p) {\n          return p.label === 'Id';\n        })[0]);\n        this.diagramEngine.getDiagramModel().addAll(relationtNode, link1, link2);\n        this.selectedRelation = RelationType.none;\n      }\n\n      this.selectedRelation = RelationType.none;\n    }\n  }, {\n    key: \"canLinkToPort\",\n    value: function canLinkToPort(port) {\n      console.log('PORT', this.selectedRelation);\n\n      if (this.selectedRelation === RelationType.none) {\n        return true;\n      } else if (port instanceof Port) {\n        if (this.selectedRelation !== RelationType.M2M && (this.isPrimaryKey && port.isPrimaryKey || this.isPrimaryKey && port.isForeignKey || this.isForeignKey && port.isPrimaryKey)) {\n          var nodeToLink = port.getNode();\n          this.link(nodeToLink);\n        } else if (this.selectedRelation === RelationType.M2M && this.iterator === 1) {\n          if (this.firstM2M === 1) {\n            var _nodeToLink = port.getNode();\n\n            var relNode = this.createM2MNode(this.getNode().name, _nodeToLink.name);\n\n            if (relNode !== null) {\n              this.addRelationLink(this.getNode(), relNode, port.getNode(), port, this.getNode().name, _nodeToLink.name);\n              var app = this.diagramEngine.getDiagramModel().getNodes();\n              Object.keys(app).forEach(function (x) {\n                return app[x].updatePorts(RelationType.none);\n              });\n            } else {\n              var _app = this.diagramEngine.getDiagramModel().getNodes();\n\n              Object.keys(_app).forEach(function (x) {\n                return _app[x].updatePorts(RelationType.none);\n              });\n              this.selectedRelation = RelationType.none;\n              this.firstM2M = 0;\n              this.iterator = 0;\n            }\n          }\n\n          return false;\n        }\n\n        return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"createLinkModel\",\n    value: function createLinkModel() {\n      var link = _get(_getPrototypeOf(Port.prototype), \"createLinkModel\", this).call(this);\n\n      if (this.selectedRelation === RelationType.O2O) {\n        return new Link(\"default\", RelationType.O2O);\n      } else if (this.selectedRelation === RelationType.O2M) {\n        return new Link(\"default\", RelationType.O2M);\n      } else if (this.selectedRelation === RelationType.M2M) {\n        return new Link(\"default\", RelationType.M2M);\n      } else {\n        return null;\n      }\n    }\n  }]);\n\n  return Port;\n}(PortModel);","map":{"version":3,"sources":["/home/dell/Dokumenty/sql-gen2/sql-gen2/sql-generator2/src/components/models/Port.ts"],"names":["_","PortModel","Link","PropertyType","Node","RelationType","Port","isNotNull","isAutoIncremented","isUnique","isPrimaryKey","isForeignKey","isInput","name","label","selectedRelation","diagramEngine","propertyType","id","in","links","iterator","firstM2M","O2O","O2M","M2M","console","log","object","engine","merge","isAutoincremented","nodeToLink","thisPortNode","getNode","ports","getInPorts","isThereAlreadyThatPort","filter","p","length","link","createLinkModel","setSourcePort","newPort","addInPort","INT","setTargetPort","getDiagramModel","addLink","recalculatePortsVisually","none","portLinks","getLinks","linkToDelete","Object","keys","l","getTargetPort","removeLink","port1Name","port2Name","nodes","getNodes","isAlredy","x","slice","relationNode","node1","relationtNode","node2","port","link1","link2","addAll","relNode","createM2MNode","addRelationLink","app","forEach","updatePorts"],"mappings":"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","sourcesContent":["import * as _ from \"lodash\";\nimport { PortModel, DiagramEngine, LinkModel, DefaultLinkModel, NodeModel, DiagramModel } from \"storm-react-diagrams\";\nimport { Link } from \"./Link\";\nimport { PropertyType } from \"./PropertyType\";\nimport { Node } from \"./Node\";\nimport { RelationType } from \"../../App2\";\n\nexport class Port extends PortModel {\n\n\tin: boolean;\n\tlabel: string;\n\tpropertyType: string;\n\tisPrimaryKey: boolean;\n\tisForeignKey: boolean;\n\tisNotNull: boolean;\n\tisUnique: boolean;\n\tisAutoIncremented: boolean;\n\tlinks: { [id: string]: Link };\n\titerator: number = 1;\n\tfirstM2M: number = 1;\n\tselectedRelation: RelationType;\n\tdiagramEngine: DiagramEngine;\n\n\tconstructor(isNotNull: boolean, isAutoIncremented: boolean, isUnique: boolean, isPrimaryKey: boolean, isForeignKey: boolean, isInput: boolean, name: string, label: string = null, selectedRelation: RelationType, diagramEngine?: DiagramEngine, propertyType?: PropertyType, id?: string) {\n\t\tsuper(name, \"with_prop\", id);\n\t\tthis.in = isInput;\n\t\tthis.label = label || name;\n\t\tthis.links = {};\n\t\tthis.propertyType = PropertyType[propertyType];\n\t\tthis.isForeignKey = isForeignKey;\n\t\tthis.isPrimaryKey = isPrimaryKey;\n\t\tthis.selectedRelation = selectedRelation;\n\t\tthis.diagramEngine = diagramEngine;\n\t\tthis.isAutoIncremented = isAutoIncremented;\n\t\tthis.isUnique = isUnique;\n\t\tthis.isNotNull = isNotNull;\n\n\t}\n\n\tupdatePortRelation(selectedRelation: RelationType) {\n\t\tif((this.selectedRelation === RelationType.O2O ) || (this.selectedRelation === RelationType.O2M ) &&  selectedRelation === RelationType.M2M) {\n\t\t\tconsole.log('zmiana');\n\t\t\tthis.selectedRelation = selectedRelation;\n\t\t}\n\t}\n\n\tdeSerialize(object: any, engine: DiagramEngine) {\n\t\tsuper.deSerialize(object, engine);\n\t\tthis.in = object.in;\n\t\tthis.label = object.label;\n\t}\n\n\tserialize() {\n\t\treturn _.merge(super.serialize(), {\n\t\t\tin: this.in,\n\t\t\tlabel: this.label,\n\t\t\tpropertyType: this.propertyType,\n\t\t\tisForeignKey: this.isForeignKey,\n\t\t\tisPrimaryKey: this.isPrimaryKey,\n\t\t\tisNotNull: this.isNotNull,\n\t\t\tisAutoincremented: this.isAutoIncremented,\n\t\t\tisUnique: this.isUnique\n\t\t});\n\t}\n\n\tinitialLink(nodeToLink: Node): LinkModel {\n\t\tlet thisPortNode = this.getNode() as Node;\n\t\tlet ports = nodeToLink.getInPorts();\n\t\tlet isThereAlreadyThatPort = ports.filter(p => p.label === `${thisPortNode.name}Id`).length;\n\t\tif (isThereAlreadyThatPort === 0) {\n\n\t\t\tlet link = this.createLinkModel();\n\t\t\tif (link !== null) {\n\t\t\t\tlink.setSourcePort(this)\n\t\t\t\tlet newPort = nodeToLink.addInPort(true,false, false, false, true, `${thisPortNode.name}Id`, this.selectedRelation, this.diagramEngine, PropertyType.INT);\n\t\t\t\tconsole.log('ports', this, newPort);\n\t\t\t\tlink.setTargetPort(newPort);\n\t\t\t\tthis.diagramEngine.getDiagramModel().addLink(link);\n\t\t\t\tthis.diagramEngine.recalculatePortsVisually();\n\t\t\t\tconsole.log('link', link);\n\n\t\t\t\tthis.selectedRelation = RelationType.none;\n\n\t\t\t}\n\n\t\t}\n\t\tthis.selectedRelation = RelationType.none;\n\n\t\treturn null;\n\t}\n\n\tlink(nodeToLink: Node): LinkModel {\n\n\t\tlet thisPortNode = this.getNode() as Node;\n\t\tlet ports = nodeToLink.getInPorts();\n\t\tlet isThereAlreadyThatPort = ports.filter(p => p.label === `${thisPortNode.name}Id`).length;\n\t\tif (isThereAlreadyThatPort === 0) {\n\t\t\tif (this.iterator === 1) {\n\t\t\t\tlet portLinks = this.getLinks() as { [s: string]: Link }; { }\n\t\t\t\tlet linkToDelete = Object.keys(portLinks).filter(l => portLinks[l].getTargetPort() === ports.filter(p => p.label === 'Id')[0]);\n\n\t\t\t\tthis.diagramEngine.getDiagramModel().removeLink(linkToDelete[0])\n\t\t\t}\n\n\n\t\t\tlet link = this.createLinkModel();\n\t\t\tif (link !== null) {\n\t\t\t\tlink.setSourcePort(this)\n\t\t\t\tlet newPort = nodeToLink.addInPort(true,false, false,false, true, `${thisPortNode.name}Id`, this.selectedRelation, this.diagramEngine, PropertyType.INT);\n\t\t\t\tconsole.log('ports', this, newPort);\n\t\t\t\tlink.setTargetPort(newPort);\n\t\t\t\tthis.diagramEngine.getDiagramModel().addLink(link);\n\t\t\t\tthis.diagramEngine.recalculatePortsVisually();\n\t\t\t\tconsole.log('link', link);\n\n\t\t\t\tthis.selectedRelation = RelationType.none;\n\n\t\t\t}\n\n\t\t}\n\t\tthis.selectedRelation = RelationType.none;\n\n\t\treturn null;\n\t}\n\n\tcreateM2MNode(port1Name: string, port2Name: string) {\n\t\tlet nodes = this.diagramEngine.getDiagramModel().getNodes() as { [s: string]: Node };\n\t\tlet isAlredy = Object.keys(nodes).filter(x => nodes[x].name.slice(3) === `${port1Name.slice(3, 8)}Has${port2Name}`);\n\n\n\t\tif (isAlredy.length === 0) {\n\t\t\tlet relationNode = new Node('table', `rl_${port1Name}Has${port2Name}`);\n\t\t\trelationNode.addInPort(true,true, true,true, false, `Id`, this.selectedRelation, this.diagramEngine, PropertyType.INT)\n\t\t\trelationNode.addInPort(true,true, false,false, true, `${port1Name}Id`, this.selectedRelation, this.diagramEngine, PropertyType.INT)\n\t\t\trelationNode.addInPort(true,true, false,false, true, `${port2Name}Id`, this.selectedRelation, this.diagramEngine, PropertyType.INT)\n\t\t\tthis.diagramEngine.recalculatePortsVisually();\n\n\t\t\treturn relationNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddRelationLink(node1: Node, relationtNode: Node, node2: Node, port: Port, port1Name: string, port2Name: string) {\n\t\tlet portLinks = this.getLinks() as { [s: string]: Link };\n\n\t\tlet link = Object.keys(portLinks).filter(l => portLinks[l].getTargetPort() === port);\n\n\n\t\tthis.diagramEngine.getDiagramModel().removeLink(link[0])\n\n\n\t\tlet link1 = this.createLinkModel();\n\t\tlet link2 = this.createLinkModel();\n\t\tif (!link1 || !link2) {\n\t\t} else {\n\t\t\tlink1.setSourcePort(node1.getInPorts().filter(p => p.label === 'Id')[0])\n\t\t\tlink1.setTargetPort(relationtNode.getInPorts().filter(p => p.label === `${port1Name}Id`)[0])\n\t\t\tlink2.setSourcePort(relationtNode.getInPorts().filter(p => p.label === `${port2Name}Id`)[0])\n\t\t\tlink2.setTargetPort(node2.getInPorts().filter(p => p.label === 'Id')[0])\n\t\t\tthis.diagramEngine.getDiagramModel().addAll(relationtNode, link1, link2);\n\t\t\tthis.selectedRelation = RelationType.none;\n\t\t}\n\t\tthis.selectedRelation = RelationType.none;\n\n\n\t}\n\n\tcanLinkToPort(port: PortModel): boolean {\n\t\tconsole.log('PORT', this.selectedRelation);\n\t\tif (this.selectedRelation === RelationType.none) {\n\t\t\treturn true;\n\t\t} else\n\t\t\tif (port instanceof Port) {\n\n\t\t\t\tif (this.selectedRelation !== RelationType.M2M && (this.isPrimaryKey && port.isPrimaryKey || this.isPrimaryKey && port.isForeignKey || this.isForeignKey && port.isPrimaryKey)) {\n\t\t\t\t\tlet nodeToLink = port.getNode() as Node;\n\t\t\t\t\tthis.link(nodeToLink);\n\t\t\t\t}\n\t\t\t\telse if (this.selectedRelation === RelationType.M2M && this.iterator === 1) {\n\t\t\t\t\tif (this.firstM2M === 1) {\n\t\t\t\t\t\tlet nodeToLink = port.getNode() as Node;\n\t\t\t\t\t\tlet relNode = this.createM2MNode((this.getNode() as Node).name, nodeToLink.name);\n\t\t\t\t\t\tif (relNode !== null) {\n\t\t\t\t\t\t\tthis.addRelationLink(this.getNode() as Node, relNode, port.getNode() as Node, port, (this.getNode() as Node).name, nodeToLink.name);\n\t\t\t\t\t\t\tlet app = this.diagramEngine.getDiagramModel().getNodes() as { [s: string]: Node };\n\t\t\t\t\t\t\tObject.keys(app).forEach(x => app[x].updatePorts(RelationType.none));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet app = this.diagramEngine.getDiagramModel().getNodes() as { [s: string]: Node };\n\t\t\t\t\t\t\tObject.keys(app).forEach(x => app[x].updatePorts(RelationType.none));\n\n\t\t\t\t\t\t\tthis.selectedRelation = RelationType.none;\n\t\t\t\t\t\t\tthis.firstM2M = 0;\n\t\t\t\t\t\t\tthis.iterator = 0\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\treturn false;\n\n\n\t}\n\n\tcreateLinkModel(): LinkModel {\n\t\tlet link = super.createLinkModel();\n\t\tif (this.selectedRelation === RelationType.O2O) {\n\t\t\treturn new Link(\"default\", RelationType.O2O);\n\t\t} else if (this.selectedRelation === RelationType.O2M) {\n\t\t\treturn new Link(\"default\", RelationType.O2M);\n\t\t} else if (this.selectedRelation === RelationType.M2M) {\n\t\t\treturn new Link(\"default\", RelationType.M2M);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\n\t}\n}"]},"metadata":{},"sourceType":"module"}